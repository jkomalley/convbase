name: CD

on:
    workflow_dispatch:
        inputs:
            tag:
                description: "The version to tag, without leading 'v'."
                type: string
            test:
                description: "If selected, deploy to testpypi."
                type: boolean
                default: true

jobs:
    validate-tag:
        runs-on: ubuntu-latest

    lint:
        runs-on: ubuntu-latest

    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                python-version: "3.12"
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install build
            - name: Build package
              run: python -m build

    test:
        runs-on: ubuntu-latest

    # release:
    #     name: Upload to PyPI
    #     runs-on: ubuntu-latest
    #     needs:
    #         - lint
    #         - build
    #         - test
    #     if: ${{ ! inputs.test }}
    #     environment:
    #         name: release
    #     permissions:
    #         id-token: write
    #     steps:
    #         - name: PyPI Publish
    #           uses: pypa/gh-action-pypi-publish@release/v1

    # test-release:
    #     name: Upload to TestPyPI
    #     runs-on: ubuntu-latest
    #     needs:
    #         - lint
    #         - build
    #         - test
    #     if: ${{ inputs.test }}
    #     environment:
    #         name: release
    #     permissions:
    #         id-token: write
    #     steps:
    #         - name: TestPyPI Publish
    #           uses: pypa/gh-action-pypi-publish@release/v1
    #           with:
    #             repository-url: https://test.pypi.org/legacy/
